<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.122.0"><meta name=description content="This is my new hugo site"><meta name=keywords content="hugo,site,new"><meta name=author content="Yingquan Li"><title>Airflow Documentation |
Let's blog!
</title><link rel=stylesheet href=/blog/css/index_d751713.min.500307a5d41c54d080496fd95816e457b3c1b4fbb85d6b6a1f270870e0648c7732abe9b066867cf4da7593bcf6715ec0538865a513c72448b8334d3b7f53c209.css integrity="sha512-UAMHpdQcVNCASW/ZWBbkV7PBtPu4XWtqHycIcOBkjHcyq+mwZoZ89Np1k7z2cV7AU4hlpRPHJEi4M007f1PCCQ=="></head><body><header class=header><div class=header_left></div><div class=header_middle>Airflow Documentation -
Let's blog!</div></header><main><aside class=sidebar><ul class=section-tree><li class="dir opened-dir"><span class=dir-text>Engineering Posts</span><ul class=section-tree><li class=file><a href=https://yli12313.github.io/blog/engineering-posts/20240130_volunteering_mths/ title=./blog/engineering-posts/20240130_volunteering_mths/>Volunteering at McKinley Technology High School</a></li><li class=file><a href=https://yli12313.github.io/blog/engineering-posts/20231221_airflow_documentation/ title=./blog/engineering-posts/20231221_airflow_documentation/>Airflow Documentation</a></li></ul></li><li class="dir closed-dir"><span class=dir-text>Economics and Finance Posts</span><ul class=section-tree><li class=file><a href=https://yli12313.github.io/blog/economics-and-finance-posts/20240130_br_titan/ title=./blog/economics-and-finance-posts/20240130_br_titan/>Book Review: Titan: The Life of John D. Rockefeller, Sr.</a></li><li class=file><a href=https://yli12313.github.io/blog/economics-and-finance-posts/20231225_commanding_heights/ title=./blog/economics-and-finance-posts/20231225_commanding_heights/>Review: The Commanding Heights (2002 Documentary)</a></li></ul></li></ul></aside><aside class=exapandable></aside><article class=main><button class=sidebar-toggle-btn type=menu aria-expanded=false aria-haspopup=true>
<i class="bi bi-list"></i></button><div class=title><h1 class=title-header>Airflow Documentation</h1><div class=author-date-readtime><div class=author title=Author><i class="bi bi-person"></i>
<a href=/blog/author/yingquan-li/ class=cat-btn>Yingquan Li</a></div><div class=date title=Date><i class="bi bi-calendar3"></i>
<time datetime=2023.12.21>2023.12.21</time></div><div class=readtime title="Time to Read"><i class="bi bi-clock"></i>
2 mins to read</div></div></div><div class=article-meta><div class=breadcumb><i class="bi bi-folder"></i>
<a href=https://yli12313.github.io/blog/ class=bread-btn><i class="bi bi-house-fill"></i>
Home
</a>/
<a href=https://yli12313.github.io/blog/engineering-posts/ class=bread-btn>Engineering Posts
</a>/
<a href=https://yli12313.github.io/blog/engineering-posts/20231221_airflow_documentation/ class=bread-btn>Airflow Documentation</a></div></div><nav id=TableOfContents></nav><div class=content><ul><li>These notes are taken from the official Apache Airflow website <a href=https://airflow.apache.org/docs/apache-airflow/stable/index.html>Documentation</a> section. Will possibly need to reference these notes later.</li><li>&ldquo;<strong>Apache Airflow</strong> is an open source platform for developing, scheduling, and monitoring batch-oriented workflows. Airflowâ€™s extensible Python framework enables you to build workflows connecting with virtually any technology. A web interface helps manage the state of your workflows. Airflow is deployable in many ways, varying from a single process on your laptop to a distributed setup to support even the biggest workflows.&rdquo;</li></ul><h1 id=fundamental-conceptshttpsairflowapacheorgdocsapache-airflowstabletutorialfundamentalshtml><a href=https://airflow.apache.org/docs/apache-airflow/stable/tutorial/fundamentals.html>Fundamental Concepts</a></h1><p>&ldquo;An Airflow pipeline is just a Python script that happens to define an Airflow DAG object.&rdquo;</p><p><strong>Example DAG</strong>:</p><div class=codeblock style=overflow-x:auto;background-color:#272822;margin-top:10px;margin-bottom:10px><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> textwrap
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime, timedelta
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> airflow.models.dag <span style=color:#f92672>import</span> DAG
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> airflow.operators.bash <span style=color:#f92672>import</span> BashOperator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> DAG(
</span></span><span style=display:flex><span>   <span style=color:#e6db74>&#34;tutorial&#34;</span>,
</span></span><span style=display:flex><span>   default_args <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;depends_on_past&#34;</span>: <span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;email&#34;</span>: [<span style=color:#e6db74>&#34;airflow@example.com&#34;</span>],
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;email_on_failure&#34;</span>: <span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;email_on_retry&#34;</span>: <span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;retries&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;retry_delay&#34;</span>: timedelta(minutes <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>),
</span></span><span style=display:flex><span>   },
</span></span><span style=display:flex><span>   description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A simple tutorial DAG&#34;</span>,
</span></span><span style=display:flex><span>   schedule <span style=color:#f92672>=</span> timedelta(days <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>   start_date <span style=color:#f92672>=</span> datetime(<span style=color:#ae81ff>2021</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>   catchup <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>   tags <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;example&#34;</span>],
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>as</span> dag:
</span></span><span style=display:flex><span>   t1 <span style=color:#f92672>=</span> BashOperator(
</span></span><span style=display:flex><span>       task_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;print_date&#34;</span>,
</span></span><span style=display:flex><span>       bash_command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;date&#34;</span>,
</span></span><span style=display:flex><span>   )
</span></span><span style=display:flex><span>   t2 <span style=color:#f92672>=</span> BashOperator(
</span></span><span style=display:flex><span>       task_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sleep&#34;</span>,
</span></span><span style=display:flex><span>       depends_on_past <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>       bash_command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sleep 5&#34;</span>,
</span></span><span style=display:flex><span>       retries <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>   )
</span></span><span style=display:flex><span>   t1<span style=color:#f92672>.</span>doc_md <span style=color:#f92672>=</span> textwrap<span style=color:#f92672>.</span>dedent(
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;&#34;&#34;</span><span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span><span style=color:#e6db74>   #### Task Documentation
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   You can document your task using the attributes `doc_md` (markdown),
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   `doc` (plain text), `doc_rst`, `doc_json`, `doc_yaml` which gets
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   rendered in the UI&#39;s Task Instance Details page.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   ![img](http://montcs.bloomu.edu/~bobmon/Semesters/2012-01/491/import</span><span style=color:#e6db74>%20s</span><span style=color:#e6db74>oul.png)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   **Image Credit:** Randall Munroe, [XKCD](https://xkcd.com/license.html)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>   )
</span></span><span style=display:flex><span>   dag<span style=color:#f92672>.</span>doc_md <span style=color:#f92672>=</span> __doc__
</span></span><span style=display:flex><span>   dag<span style=color:#f92672>.</span>doc_md <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   This is a documentation placed anywhere
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>   templated_command <span style=color:#f92672>=</span> textwrap<span style=color:#f92672>.</span>dedent(
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or i in range(5) %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       echo &#34;{{ ds }}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       echo &#34;{{ macros.ds_add(ds, 7)}}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>   )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   t3 <span style=color:#f92672>=</span> BashOperator(
</span></span><span style=display:flex><span>       task_id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;templated&#34;</span>,
</span></span><span style=display:flex><span>       depends_on_past<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>       bash_command<span style=color:#f92672>=</span>templated_command,
</span></span><span style=display:flex><span>   )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   t1 <span style=color:#f92672>&gt;&gt;</span> [t2, t3]</span></span></code></pre></div></div><p><strong>Command Line Metadata Validation</strong>:</p><div class=codeblock style=overflow-x:auto;background-color:#272822;margin-top:10px;margin-bottom:10px><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># initialize the database tables</span>
</span></span><span style=display:flex><span>airflow db migrate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># print the list of active DAGs</span>
</span></span><span style=display:flex><span>airflow dags list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># prints the list of tasks in the &#34;tutorial&#34; DAG</span>
</span></span><span style=display:flex><span>airflow tasks list tutorial
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># prints the hierarchy of tasks in the &#34;tutorial&#34; DAG</span>
</span></span><span style=display:flex><span>airflow tasks list tutorial <span style=color:#f92672>--</span>tree</span></span></code></pre></div></div><p><strong>Command Layout</strong>:</p><div class=codeblock style=overflow-x:auto;background-color:#272822;margin-top:10px;margin-bottom:10px><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># command layout: command subcommand [dag_id] [task_id] [(optional) date]</span></span></span></code></pre></div></div><h1 id=working-with-taskflowhttpsairflowapacheorgdocsapache-airflowstabletutorialtaskflowhtml><a href=https://airflow.apache.org/docs/apache-airflow/stable/tutorial/taskflow.html>Working with TaskFlow</a></h1><p><strong>Example &ldquo;TaskFlow API&rdquo; Pipeline</strong>:</p><div class=codeblock style=overflow-x:auto;background-color:#272822;margin-top:10px;margin-bottom:10px><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pendulum
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> airflow.decorators <span style=color:#f92672>import</span> dag, task
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@dag</span>(
</span></span><span style=display:flex><span>   schedule<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>,
</span></span><span style=display:flex><span>   start_date<span style=color:#f92672>=</span>pendulum<span style=color:#f92672>.</span>datetime(<span style=color:#ae81ff>2021</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, tz<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTC&#34;</span>),
</span></span><span style=display:flex><span>   catchup<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>   tags<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;example&#34;</span>],
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>tutorial_taskflow_api</span>():
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@task</span>()
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>extract</span>():
</span></span><span style=display:flex><span>       data_string <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;{&#34;1001&#34;: 301.27, &#34;1002&#34;: 433.21, &#34;1003&#34;: 502.22}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       order_data_dict <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(data_string)
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>return</span> order_data_dict
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@task</span>(multiple_outputs<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>transform</span>(order_data_dict: dict):
</span></span><span style=display:flex><span>       total_order_value <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>for</span> value <span style=color:#f92672>in</span> order_data_dict<span style=color:#f92672>.</span>values():
</span></span><span style=display:flex><span>           total_order_value <span style=color:#f92672>+=</span> value
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>return</span> {<span style=color:#e6db74>&#34;total_order_value&#34;</span>: total_order_value}
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@task</span>()
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load</span>(total_order_value: float):
</span></span><span style=display:flex><span>       print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Total order value is: </span><span style=color:#e6db74>{</span>total_order_value<span style=color:#e6db74>:</span><span style=color:#e6db74>.2f</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   order_data <span style=color:#f92672>=</span> extract()
</span></span><span style=display:flex><span>   order_summary <span style=color:#f92672>=</span> transform(order_data)
</span></span><span style=display:flex><span>   load(order_summary[<span style=color:#e6db74>&#34;total_order_value&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tutorial_taskflow_api()</span></span></code></pre></div></div></div></article></main><footer class=footer><div class=footer-left><ul class=social><li>All Rights Reserved Â® 2024.</li><li>Yingquan Li</li></ul></div><div class=footer-right><ul class="control status clearfix"><li>Word Count:
417</li><li>en</li><li><a href=https://gohugo.io class=btn target=_blank>Hugo: 0.122.0</a></li><li><a href=https://github.com/JingWangTW/dark-theme-editor class=btn target=_blank>Theme: dark-theme-editor</a></li><li>Last modified: &nbsp;
<time>Dec 21 2023 18:31:53</time></li><li title></li></ul></div></footer></body><script type=text/javascript src=/blog/js/index_d751713.min.5eeb120f16ea146352725c420364f87befead45f678142b8f0ffbef024646931fbc06bff07a7bd6cb57fa2f8cd8a21ba6a4ee5a278ec32303a378bc1cd17f246.js integrity="sha512-XusSDxbqFGNSclxCA2T4e+/q1F9ngUK48P++8CRkaTH7wGv/B6e9bLV/ovjNiiG6ak7lonjsMjA6N4vBzRfyRg=="></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css></html>